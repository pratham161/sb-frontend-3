---
import AdminLayout from '../../../../layouts/AdminLayout.astro';
import JoditEditorWrapper from '../../../../components/JoditEditorWrapper';

// Disable static generation for admin pages
export const prerender = false;

const { id } = Astro.params;
---

<AdminLayout title={`Edit Article - ${id} - Symbiocroft Admin`}>
  <!-- Header -->
  <div class="mb-8">
    <div class="flex items-center gap-3 mb-4">
      <a href="/admin/articles" class="text-gray-400 hover:text-white transition-colors">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
        </svg>
      </a>
      <div>
        <h1 class="text-3xl font-bold text-white">Edit Article</h1>
        <p class="text-gray-400">Update article content and settings</p>
      </div>
    </div>
  </div>

  <form id="articleForm" class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <!-- Main Content -->
    <div class="lg:col-span-2 space-y-6">
      <!-- Basic Information -->
      <div class="bg-gray-800/50 backdrop-blur-sm border border-green-500/30 rounded-xl p-6">
        <h2 class="text-xl font-bold text-white mb-4">Article Details</h2>
        
        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-300 mb-2">Title *</label>
            <input
              type="text"
              name="title"
              value="Health Benefits of Spirulina"
              required
              class="w-full px-4 py-3 bg-gray-900/50 border border-gray-600 rounded-lg text-white focus:border-green-500 focus:ring-2 focus:ring-green-500/20 focus:outline-none"
            />
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-300 mb-2">Slug (URL) *</label>
            <input
              type="text"
              name="slug"
              value="health-benefits-spirulina"
              required
              disabled
              class="w-full px-4 py-3 bg-gray-900/50 border border-gray-600 rounded-lg text-gray-500 cursor-not-allowed"
            />
            <p class="text-xs text-gray-500 mt-1">URL slug cannot be changed</p>
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-300 mb-2">Excerpt *</label>
            <textarea
              name="excerpt"
              rows="3"
              required
              class="w-full px-4 py-3 bg-gray-900/50 border border-gray-600 rounded-lg text-white focus:border-green-500 focus:ring-2 focus:ring-green-500/20 focus:outline-none resize-none"
            >Learn about the amazing health benefits of spirulina and how it can improve your well-being.</textarea>
          </div>
        </div>
      </div>

      <!-- Rich Text Editor -->
      <div class="bg-gray-800/50 backdrop-blur-sm border border-green-500/30 rounded-xl p-6">
        <h2 class="text-xl font-bold text-white mb-4">Article Content *</h2>
        <div id="editorContainer">
          <JoditEditorWrapper client:only="react" value="<h2>Introduction</h2><p>Spirulina is a nutrient-rich superfood...</p>" onChange={(content: string) => {
            const input = document.getElementById('articleContent') as HTMLInputElement;
            if (input) input.value = content;
          }} />
        </div>
        <input type="hidden" id="articleContent" name="content" />
      </div>

      <!-- SEO Section -->
      <div class="bg-gray-800/50 backdrop-blur-sm border border-green-500/30 rounded-xl p-6">
        <h2 class="text-xl font-bold text-white mb-4">SEO Settings</h2>
        
        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-300 mb-2">Meta Title</label>
            <input
              type="text"
              name="metaTitle"
              value="Health Benefits of Spirulina | Symbiocroft"
              class="w-full px-4 py-3 bg-gray-900/50 border border-gray-600 rounded-lg text-white focus:border-green-500 focus:ring-2 focus:ring-green-500/20 focus:outline-none"
            />
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-300 mb-2">Meta Description</label>
            <textarea
              name="metaDesc"
              rows="2"
              class="w-full px-4 py-3 bg-gray-900/50 border border-gray-600 rounded-lg text-white focus:border-green-500 focus:ring-2 focus:ring-green-500/20 focus:outline-none resize-none"
            >Discover the incredible health benefits of spirulina and why it's considered a superfood.</textarea>
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-300 mb-2">Keywords</label>
            <input
              type="text"
              name="keywords"
              value="spirulina, health, superfood, nutrition"
              class="w-full px-4 py-3 bg-gray-900/50 border border-gray-600 rounded-lg text-white focus:border-green-500 focus:ring-2 focus:ring-green-500/20 focus:outline-none"
            />
          </div>
        </div>
      </div>
    </div>

    <!-- Sidebar (same as new article) -->
    <div class="space-y-6">
      <div class="bg-gray-800/50 backdrop-blur-sm border border-green-500/30 rounded-xl p-6">
        <h2 class="text-xl font-bold text-white mb-4">Publishing</h2>
        
        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-300 mb-2">Status</label>
            <select
              name="status"
              class="w-full px-4 py-3 bg-gray-900/50 border border-gray-600 rounded-lg text-white focus:border-green-500 focus:ring-2 focus:ring-green-500/20 focus:outline-none"
            >
              <option value="draft">Draft</option>
              <option value="published" selected>Published</option>
              <option value="scheduled">Scheduled</option>
            </select>
          </div>

          <label class="flex items-center gap-2">
            <input
              type="checkbox"
              name="featured"
              checked
              class="w-4 h-4 rounded border-gray-600 bg-gray-900/50 text-green-500 focus:ring-green-500/20"
            />
            <span class="text-sm text-gray-300">Featured Article</span>
          </label>
        </div>
      </div>

      <div class="bg-gray-800/50 backdrop-blur-sm border border-green-500/30 rounded-xl p-6">
        <h2 class="text-xl font-bold text-white mb-4">Organization</h2>
        
        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-300 mb-2">Category *</label>
            <select
              name="category"
              required
              class="w-full px-4 py-3 bg-gray-900/50 border border-gray-600 rounded-lg text-white focus:border-green-500 focus:ring-2 focus:ring-green-500/20 focus:outline-none"
            >
              <option value="health" selected>Health</option>
              <option value="recipes">Recipes</option>
              <option value="news">News</option>
              <option value="research">Research</option>
            </select>
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-300 mb-2">Tags</label>
            <input
              type="text"
              name="tags"
              value="health, nutrition, benefits"
              class="w-full px-4 py-3 bg-gray-900/50 border border-gray-600 rounded-lg text-white focus:border-green-500 focus:ring-2 focus:ring-green-500/20 focus:outline-none"
            />
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-300 mb-2">Author *</label>
            <input
              type="text"
              name="author"
              value="Dr. Sharma"
              required
              class="w-full px-4 py-3 bg-gray-900/50 border border-gray-600 rounded-lg text-white focus:border-green-500 focus:ring-2 focus:ring-green-500/20 focus:outline-none"
            />
          </div>
        </div>
      </div>

      <div class="bg-gray-800/50 backdrop-blur-sm border border-green-500/30 rounded-xl p-6">
        <div class="space-y-3">
          <button
            type="submit"
            class="w-full py-3 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-semibold rounded-lg transition-all duration-200 transform active:scale-95"
          >
            Update Article
          </button>
          <a
            href="/admin/articles"
            class="block w-full py-3 bg-gray-700/50 hover:bg-gray-700/70 text-gray-300 font-semibold rounded-lg transition-all text-center"
          >
            Cancel
          </a>
          <button
            type="button"
            class="w-full py-3 bg-red-500/20 hover:bg-red-500/30 text-red-400 font-semibold rounded-lg transition-all"
          >
            Delete Article
          </button>
        </div>
      </div>
    </div>
  </form>
</AdminLayout>

<script>
  const articleForm = document.getElementById('articleForm');
  if (articleForm) {
    articleForm.addEventListener('submit', (e) => {
      e.preventDefault();
      console.log('Article updated');
      alert('Article updated successfully! (Demo mode)');
    });
  }
</script>

<style>
  :global(.jodit-editor-wrapper) {
    @apply rounded-lg overflow-hidden;
  }
</style>
